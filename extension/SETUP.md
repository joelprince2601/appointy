# Synapse Capture Extension - Setup Guide

## Quick Start

### 1. Install Dependencies

```bash
cd extension
npm install
```

### 2. Create Extension Icons

Create icon files in `extension/icons/`:
- `icon16.png` (16x16 pixels)
- `icon32.png` (32x32 pixels)
- `icon48.png` (48x48 pixels)
- `icon128.png` (128x128 pixels)

**Quick Icon Creation:**
- Use any image editor (Photoshop, GIMP, Figma, Canva)
- Create a simple brain/network/synapse symbol
- Export at the required sizes
- Or use an online tool like [Favicon Generator](https://favicon.io/)

### 3. Build the Extension

```bash
npm run build
```

This creates a `dist` folder with compiled files.

### 4. Load in Chrome

1. Open Chrome
2. Go to `chrome://extensions/`
3. Enable **Developer mode** (toggle top-right)
4. Click **Load unpacked**
5. Select the `extension` folder (or `extension/dist` if using built version)

### 5. Configure API Endpoint

Update these files with your actual API URL:

**background.js** (line 7):
```javascript
const API_BASE = 'https://synapse.myapp.com/api';
```

**popup.jsx** (line 8):
```javascript
const API_BASE = 'https://synapse.myapp.com/api';
```

## Development Workflow

### Watch Mode (Auto-rebuild)

```bash
npm run dev
```

This watches for file changes and rebuilds automatically.

### Manual Build

```bash
npm run build
```

## File Structure

```
extension/
├── manifest.json          # Extension manifest (Manifest V3)
├── background.js          # Service worker
├── contentScript.js       # Content script (runs on web pages)
├── content.css            # Styles for content script
├── storage.js             # IndexedDB storage manager
├── popup.html             # Popup HTML
├── popup.jsx              # React popup component
├── popup.css              # Tailwind CSS styles
├── vite.config.js         # Vite build configuration
├── tailwind.config.js     # Tailwind configuration
├── postcss.config.js      # PostCSS configuration
├── package.json           # Dependencies
├── README.md              # Full documentation
├── SETUP.md               # This file
├── .gitignore            # Git ignore rules
├── icons/                 # Extension icons (YOU NEED TO CREATE THESE)
│   ├── icon16.png
│   ├── icon32.png
│   ├── icon48.png
│   └── icon128.png
└── dist/                  # Built files (generated by build)
```

## API Requirements

Your backend needs these endpoints:

### POST /api/capture

Save captured content.

**Request Body:**
```json
{
  "content": "selected text or link",
  "url": "page url",
  "type": "text|link|image|code|email",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**Response:** 200 OK

### GET /api/recent

Get recent captures.

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**Response:**
```json
[
  {
    "content": "...",
    "url": "...",
    "type": "...",
    "timestamp": "..."
  }
]
```

### GET /api/search?q=...

Search memories.

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**Response:**
```json
[
  {
    "title": "...",
    "summary": "...",
    "url": "..."
  }
]
```

## Authentication Setup

The extension reads Supabase JWT tokens from cookies. Ensure your main site sets cookies with:

**Cookie Name Pattern:**
- `sb-*-auth-token` (Supabase default)
- `supabase.auth.token` (alternative)

**Cookie Domain:**
- Must be `.myapp.com` (or your domain)
- Must be accessible from the extension

**Cookie Format:**
```json
{
  "access_token": "...",
  "refresh_token": "...",
  ...
}
```

Or just the token string directly.

## Testing

1. **Test Text Selection:**
   - Select text on any webpage
   - Floating button should appear
   - Click to save

2. **Test Context Menu:**
   - Right-click on selected text → "Save to Synapse"
   - Right-click on link → "Save link to Synapse"
   - Right-click on image → "Save image to Synapse"

3. **Test Popup:**
   - Click extension icon
   - Should show recent items
   - Test search functionality
   - Test "Open Synapse" button

4. **Test Offline:**
   - Disconnect internet
   - Try to save content
   - Should show "Saved offline" message
   - Reconnect internet
   - Should sync automatically

## Troubleshooting

### Extension won't load
- Check `manifest.json` is valid JSON
- Verify all required files exist
- Check Chrome's extension error page

### Icons not showing
- Create icon files in `icons/` folder
- Ensure they're PNG format
- Check file paths in `manifest.json`

### Authentication failing
- Verify cookies are set correctly
- Check cookie domain matches
- Ensure CORS is configured on API

### Build errors
- Run `npm install` again
- Check Node.js version (requires 18+)
- Clear `node_modules` and reinstall

### API requests failing
- Check API endpoint URL is correct
- Verify CORS headers on backend
- Check network tab in DevTools

## Production Build

For production:

1. Update API endpoints to production URLs
2. Build: `npm run build`
3. Test the `dist` folder
4. Zip the `dist` folder for Chrome Web Store submission

## Next Steps

- [ ] Create extension icons
- [ ] Update API endpoints
- [ ] Test all features
- [ ] Configure backend CORS
- [ ] Test offline functionality
- [ ] Submit to Chrome Web Store (optional)

